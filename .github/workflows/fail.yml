name: Workflow Protection

on:
  pull_request_target:
    paths:
      - '.github/workflows/**'

# ‚≠ê G√úVENLƒ∞K: actor'√º kontrol etmek i√ßin read izni gerekli
permissions:
  pull-requests: read
  contents: none

jobs:
  check-workflow-changes:
    runs-on: ubuntu-latest
    steps:
      - name: Check if actor is in core team
        uses: actions/github-script@v7
        env:
          CORE_TEAM: ${{ vars.CORE_TEAM }}
        with:
          script: |
            const coreTeamStr = process.env.CORE_TEAM || '';
            const coreTeam = coreTeamStr.split(',').map(name => name.trim());
            const actor = context.actor;

            core.info(`üë§ PR opened by: ${actor}`);

            const isInternal = coreTeam.includes(actor);

            if (isInternal) {
              core.info('‚úÖ Actor is in core team. Allowing workflow changes.');
            } else {
              core.setFailed(`‚ùå Access Denied: ${actor} is not allowed to change workflow files. Only core team members can do this.`);
            }