name: Check Internal Issue Reference

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  check-issue-reference:
    runs-on: ubuntu-latest
    steps:
      - name: Check internal issue reference for core team PRs
        shell: bash
        run: |
          CORE_TEAM=("atakanbayrak" "aktasmehmet" "hatesalp" "sengulnecmi" "ZehranurC")
          ACTOR="${{ github.actor }}"
          PR_BODY="${{ github.event.pull_request.body }}"

          echo "üë§ PR opened by: $ACTOR"

          IS_CORE=false
          for member in "${CORE_TEAM[@]}"; do
            if [[ "$member" == "$ACTOR" ]]; then
              IS_CORE=true
              break
            fi
          done

          if [[ "$IS_CORE" != "true" ]]; then
            echo "‚ÑπÔ∏è Actor is not in core team. Skipping internal issue check."
            exit 0
          fi

          echo "üîç Actor is core team. Checking PR description..."

          if echo "$PR_BODY" | grep -Eq "#EDKUI-[0-9]+"; then
            ISSUE=$(echo "$PR_BODY" | grep -Eo "#EDKUI-[0-9]+")
            echo "‚úÖ Found internal issue reference: $ISSUE"
          else
            echo "‚ùå Core team PRs must include an internal issue reference (e.g., #EDKUI-1288)"
            exit 1
          fi