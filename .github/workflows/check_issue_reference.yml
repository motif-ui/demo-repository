name: Check Internal Issue Reference

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  check-issue-reference:
    runs-on: ubuntu-latest
    steps:
      - name: Check internal issue reference for core team PRs
        uses: actions/github-script@v7
        env:
          CORE_TEAM: ${{ vars.CORE_TEAM }}
        with:
          script: |
            const coreTeamStr = process.env.CORE_TEAM || '';
            const coreTeam = coreTeamStr.split(',').map(name => name.trim());
            const actor = context.actor;
            const prBody = context.payload.pull_request.body || '';

            core.info(`üë§ PR opened by: ${actor}`);

            const isInternal = coreTeam.includes(actor);

            if (!isInternal) {
              core.info('‚ÑπÔ∏è Actor is not in core team. Skipping internal issue check.');
              return;
            }

            core.info('üîç Actor is core team. Checking PR description...');

            const issuePattern = /#EDKUI-\d+/;
            const match = prBody.match(issuePattern);

            if (match) {
              core.info(`‚úÖ Found internal issue reference: ${match[0]}`);
            } else {
              core.setFailed('‚ùå Core team PRs must include an internal issue reference (e.g., #EDKUI-1288)');
            }
