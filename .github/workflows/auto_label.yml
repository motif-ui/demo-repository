name: Auto Label

on:
  issues:
    types: [opened, reopened]
  pull_request:
    types: [opened, reopened]

permissions:
  issues: write
  pull-requests: write
  contents: read

jobs:
  auto_label:
    runs-on: ubuntu-latest
    steps:
      - name: Auto label by author
        uses: actions/github-script@v7
        with:
          script: |
            const coreTeamRaw = process.env.CORE_TEAM;
            const coreTeam = coreTeamRaw
              .split(',')
              .map(u => u.trim());
            
            const actor = context.actor;

            const isInternal = coreTeam.includes(actor);
            const label = isInternal ? 'internal' : 'needs triage';

            core.info(`Actor: ${actor}`);
            core.info(`Internal: ${isInternal}`);
            core.info(`Applying label: ${label}`);

            const issueNumber =
              context.eventName === 'pull_request'
                ? context.payload.pull_request.number
                : context.payload.issue.number;

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              labels: [label],
            });